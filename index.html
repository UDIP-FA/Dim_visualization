<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UDIP—FA Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Default visible height; JS will auto-fit to embedded content anyway */
      --viewerBoxHeight: 420px;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Roboto',sans-serif;background:#f5f7fa;color:#333;height:100vh;display:flex;flex-direction:column;}
    header{background:#fff;padding:10px 20px;box-shadow:0 2px 4px rgba(0,0,0,.1);display:flex;align-items:center;}
    header img{height:50px;object-fit:contain;}
    #container{display:flex;flex:1;overflow:hidden;}
    #mask-select-container{width:220px;background:#fff;padding:20px;border-right:1px solid #e0e0e0;box-shadow:2px 0 8px rgba(0,0,0,.05);}
    #mask-select-container h3{font-size:16px;font-weight:500;margin-bottom:12px;color:#444;}
    #mask-select{width:100%;padding:10px;font-size:14px;border:1px solid #ccd0d5;border-radius:4px;appearance:none;
      background:url('data:image/svg+xml;utf8,<svg fill="%23666" height="12" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 12px center;
      background-color:#fff;background-size:12px;cursor:pointer;box-shadow:inset 0 1px 3px rgba(0,0,0,.05);transition:border-color .2s;}
    #mask-select:hover{border-color:#a0a8b0;}
    #mask-select:focus{border-color:#5b9dd9;outline:none;box-shadow:0 0 0 3px rgba(91,157,217,.3);}

    #main-panel{flex:1;display:flex;flex-direction:column;background:#fff;margin:20px;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,.1);overflow:hidden;}
    #viewer-container{min-height:var(--viewerBoxHeight);border-bottom:1px solid #e0e0e0;background:#fff;}
    /* No transform/scale here — show pixels 1:1 from the embedded page */
    #mask-viewer{width:100%;height:var(--viewerBoxHeight);border:none;display:block;}

    #table-container{flex:1;overflow:auto;padding:12px;background:#fafafa;}
    #table-container table{width:100%;border-collapse:collapse;font-variant-numeric:tabular-nums;}
    #table-container th,#table-container td{border:1px solid #ddd;padding:8px 10px;font-size:12px;}
    #table-container th{background:#f1f1f1;font-weight:500;position:sticky;top:0;z-index:1;}
    #table-container tbody tr:nth-child(even){background:#fcfcfc;}
    #table-container td{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    footer{background:#fff;padding:10px 20px;font-size:12px;color:#666;text-align:center;border-top:1px solid #e0e0e0;box-shadow:0 -2px 4px rgba(0,0,0,.05);}
    footer a{color:#007acc;text-decoration:none;} footer a:hover{text-decoration:underline;}

    @media (max-width:900px){
      #container{flex-direction:column;}
      #mask-select-container{width:auto;display:flex;align-items:center;gap:12px;border-right:none;border-bottom:1px solid #e0e0e0;box-shadow:none;}
      #main-panel{margin:10px;}
    }
  </style>
</head>
<body>
  <header>
    <img src="logo-horizontal.png" alt="UTHealth Houston – McWilliams School Logo">
  </header>

  <div id="container">
    <div id="mask-select-container">
      <h3>Select a dimension for visualization</h3>
      <select id="mask-select"><option value="">-- choose a mask --</option></select>
    </div>

    <div id="main-panel">
      <!-- No scaling; the script will auto-size the iframe height to the embedded content -->
      <div id="viewer-container">
        <iframe id="mask-viewer" name="maskFrame" src="" allowfullscreen></iframe>
      </div>
      <div id="table-container"></div>
    </div>
  </div>

  <footer>
    Unveiling genetic architecture of white matter microstructure through unsupervised deep representation learning of fractional anisotropy images<br>
    Xingzhong Zhao, Ziqian Xie, Wei He, Myriam Fornage, Degui Zhi<br>
    medRxiv 2025.07.04.25330856; doi:
    <a href="https://doi.org/10.1101/2025.07.04.25330856" target="_blank">10.1101/2025.07.04.25330856</a>
  </footer>

  <script>
    // ---- Paths relative to this HTML file ----
    const htmlBase = '3d_html_masks';  // e.g., 3d_html_masks/Dim_0.html  (regenerated with large width_view)
    const csvBase  = 'WM_stat';        // e.g., WM_stat/Dim_0.csv

    // Build dropdown list
    const masks = Array.from({ length: 128 }, (_, i) => ({ label:`Dim${i+1}`, value:`Dim_${i}` }));
    const selectEl = document.getElementById('mask-select');
    const maskFrame = document.getElementById('mask-viewer');
    const viewerBox = document.getElementById('viewer-container');
    const tableContainer = document.getElementById('table-container');

    masks.forEach(({label,value})=>{
      const opt=document.createElement('option'); opt.value=value; opt.textContent=label; selectEl.appendChild(opt);
    });

    const DISPLAY_HEADER = ['WM tracts','Abbreviation','observed T value','P value'];

    function renderTable(rows){
      const tbl=document.createElement('table');
      const theadRow=tbl.createTHead().insertRow();
      rows[0].forEach(c=>{ const th=document.createElement('th'); th.textContent=c; theadRow.appendChild(th); });
      const tbody=tbl.createTBody();
      rows.slice(1).forEach(r=>{ const tr=tbody.insertRow(); r.forEach(c=>{ const td=tr.insertCell(); td.textContent=c; }); });
      tableContainer.innerHTML=''; tableContainer.appendChild(tbl);
    }

    // Auto-fit iframe height to the embedded document (same-origin)
    function fitIframeToContent(){
      try{
        const doc = maskFrame.contentDocument || maskFrame.contentWindow?.document;
        if(!doc) return;
        const el = doc.documentElement, body = doc.body;
        const h = Math.max(el.scrollHeight, el.offsetHeight, el.clientHeight,
                           body?.scrollHeight||0, body?.offsetHeight||0, body?.clientHeight||0);
        // Set iframe height to content height (no scrollbars, no scaling)
        maskFrame.style.height = h + 'px';

        // Optional: hide controls inside the embedded page if present
        doc.querySelectorAll('select, .papaya-toolbar, #papayaToolbar, .papayaMenu, .papaya-control')
           .forEach(n => n.style.display='none');
      }catch(e){ /* cross-origin -> ignore */ }
    }

    selectEl.addEventListener('change', async (e)=>{
      const name=e.target.value;
      if(!name){ maskFrame.src=''; tableContainer.innerHTML=''; return; }

      maskFrame.onload = () => { fitIframeToContent(); setTimeout(fitIframeToContent, 150); };
      maskFrame.src = `${htmlBase}/${name}.html`;

      tableContainer.textContent = 'Loading CSV…';
      try{
        const resp = await fetch(`${csvBase}/${name}.csv`);
        if(!resp.ok) throw new Error(`CSV ${name} not found (${resp.status})`);
        let text = (await resp.text()).replace(/^\uFEFF/, '');
        const rows = text.trim().split(/\r?\n/).map(line => line.split(','));
        if(!rows.length || !rows[0].length){ tableContainer.textContent='CSV is empty or malformed.'; return; }

        const looksLikeHeader = /[A-Za-z]/.test(rows[0].join(''));
        if(looksLikeHeader) rows[0] = DISPLAY_HEADER.slice(0, rows[0].length);
        else rows.unshift(DISPLAY_HEADER.slice(0, rows[0].length || DISPLAY_HEADER.length));

        renderTable(rows);
      }catch(err){
        console.error(err);
        tableContainer.textContent = 'Unable to load CSV data.';
      }
    });

    // Auto-select first on load
    selectEl.value = masks[0].value;
    selectEl.dispatchEvent(new Event('change'));
  </script>
</body>
</html>
