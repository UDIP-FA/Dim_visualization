<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UDIP—FA Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <!-- Modern font -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet">

  <style>
    :root{
      /* 可自行调高/调低默认查看器高度 */
      --viewerHeight: 70vh;
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Roboto', sans-serif;
      background: #f5f7fa;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* 顶部栏 */
    header.navbar {
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    header .navbar-brand img { height: 44px; object-fit: contain; }

    /* 左侧选择面板（用卡片风格） */
    .sidebar-card {
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }

    /* 右侧：上方查看器 + 下方表格 */
    #viewer-container {
      height: var(--viewerHeight);
      border: 1px solid #e0e0e0;
      background: #fff;
      border-radius: .375rem;
      overflow: auto;         /* 重要：超出时滚动，不缩放 */
      resize: vertical;       /* 允许用户拖拽调整高度 */
    }
    #mask-viewer {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }
    #table-container {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: .375rem;
      padding: .75rem;
    }

    footer {
      background: #fff;
      font-size: 12px;
      color: #666;
      border-top: 1px solid #e0e0e0;
    }
    footer a { color: #0d6efd; text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="navbar navbar-light px-3">
    <a class="navbar-brand d-flex align-items-center gap-2" href="#">
      <img src="logo-horizontal.png" alt="UTHealth Houston – McWilliams School Logo">
      <span class="fw-medium">UDIP—FA Viewer</span>
    </a>
  </header>

  <!-- Main -->
  <main class="container-fluid my-3 flex-grow-1">
    <div class="row g-3">
      <!-- Left: selector -->
      <div class="col-12 col-md-3 col-lg-2">
        <div class="card sidebar-card">
          <div class="card-body">
            <h6 class="card-title mb-3">Select a dimension for visualization</h6>
            <select id="mask-select" class="form-select">
              <option value="">-- choose a mask --</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Right: viewer + table -->
      <div class="col-12 col-md-9 col-lg-10">
        <div class="mb-3">
          <!-- Viewer area: 不缩放，原始显示；溢出滚动 -->
          <div id="viewer-container">
            <iframe id="mask-viewer" name="maskFrame" src="" allowfullscreen></iframe>
          </div>
        </div>
        <div id="table-container" class="table-responsive">
          <!-- CSV table renders here -->
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="py-3 text-center px-3">
    Unveiling genetic architecture of white matter microstructure through unsupervised deep representation learning of fractional anisotropy images<br>
    Xingzhong Zhao, Ziqian Xie, Wei He, Myriam Fornage, Degui Zhi<br>
    medRxiv 2025.07.04.25330856; doi:
    <a href="https://doi.org/10.1101/2025.07.04.25330856" target="_blank">10.1101/2025.07.04.25330856</a>
  </footer>

  <!-- Bootstrap JS (可选，用于未来组件) -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <script>
    /* ===== 路径（相对本HTML） ===== */
    const htmlBase = '3d_html_masks';  // e.g., 3d_html_masks/Dim_0.html
    const csvBase  = 'WM_stat';        // e.g., WM_stat/Dim_0.csv

    /* 构建下拉：Dim1…Dim128（显示），值：Dim_0…Dim_127（文件基名） */
    const masks = Array.from({ length: 128 }, (_, i) => ({ label: `Dim${i + 1}`, value: `Dim_${i}` }));

    const selectEl       = document.getElementById('mask-select');
    const maskFrame      = document.getElementById('mask-viewer');
    const tableContainer = document.getElementById('table-container');

    masks.forEach(({ label, value }) => {
      const opt = document.createElement('option');
      opt.value = value; opt.textContent = label;
      selectEl.appendChild(opt);
    });

    /* 标准化表头（可按需改名） */
    const DISPLAY_HEADER = ['WM tracts', 'Abbreviation', 'observed T value', 'P value'];

    function renderTable(rows) {
      const tbl = document.createElement('table');
      tbl.className = 'table table-sm table-hover align-middle mb-0';

      const thead = tbl.createTHead();
      const theadRow = thead.insertRow();
      rows[0].forEach(c => {
        const th = document.createElement('th');
        th.scope = 'col';
        th.textContent = c;
        theadRow.appendChild(th);
      });

      const tbody = tbl.createTBody();
      rows.slice(1).forEach(r => {
        const tr = tbody.insertRow();
        r.forEach(c => {
          const td = tr.insertCell();
          td.textContent = c;
        });
      });

      tableContainer.innerHTML = '';
      tableContainer.appendChild(tbl);
    }

    /* 选择变更：仅加载 iframe & CSV，不进行任何缩放处理 */
    selectEl.addEventListener('change', async (e) => {
      const name = e.target.value;
      if (!name) { maskFrame.src = ''; tableContainer.innerHTML = ''; return; }

      maskFrame.src = `${htmlBase}/${name}.html`;

      // 加载 CSV 并渲染
      tableContainer.textContent = 'Loading CSV…';
      try {
        const resp = await fetch(`${csvBase}/${name}.csv`);
        if (!resp.ok) throw new Error(`CSV ${name} not found (${resp.status})`);
        let text = (await resp.text()).replace(/^\uFEFF/, ''); // 去掉可能的 BOM
        const rows = text.trim().split(/\r?\n/).map(line => line.split(','));
        if (!rows.length || !rows[0].length) { tableContainer.textContent = 'CSV is empty or malformed.'; return; }

        const looksLikeHeader = /[A-Za-z]/.test(rows[0].join(''));
        if (looksLikeHeader) rows[0] = DISPLAY_HEADER.slice(0, rows[0].length);
        else rows.unshift(DISPLAY_HEADER.slice(0, rows[0].length || DISPLAY_HEADER.length));

        renderTable(rows);
      } catch (err) {
        console.error(err);
        tableContainer.textContent = 'Unable to load CSV data.';
      }
    });

    // 首次自动选择第一项
    selectEl.value = masks[0].value;
    selectEl.dispatchEvent(new Event('change'));
  </script>
</body>
</html>
